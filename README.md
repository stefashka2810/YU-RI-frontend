## **üîê –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å Access –∏ Refresh —Ç–æ–∫–µ–Ω–∞–º–∏**

### **–ó–∞—á–µ–º –Ω—É–∂–Ω—ã –¥–≤–∞ —Ç–æ–∫–µ–Ω–∞?**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç–æ–∫–µ–Ω—ã ‚Äî —ç—Ç–æ **–ø—Ä–æ–ø—É—Å–∫ –≤ –∑–¥–∞–Ω–∏–µ**:
- **Access Token** (–∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫) ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç 15-60 –º–∏–Ω—É—Ç
- **Refresh Token** (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫) ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç 7-30 –¥–Ω–µ–π

---

## **üìã –ü–æ—à–∞–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**

### **1Ô∏è‚É£ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –õ–æ–≥–∏–Ω**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Email + –ü–∞—Ä–æ–ª—å ‚Üí –°–µ—Ä–≤–µ—Ä
                ‚Üì
–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
                ‚Üì
–°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 2 —Ç–æ–∫–µ–Ω–∞:
  ‚Ä¢ Access Token (–∂–∏–≤–µ—Ç 15 –º–∏–Ω)
  ‚Ä¢ Refresh Token (–∂–∏–≤–µ—Ç 7 –¥–Ω–µ–π)
                ‚Üì
–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–∞ –≤ localStorage
```

**–ß—Ç–æ –≤ —Ç–æ–∫–µ–Ω–∞—Ö:**
- **Access Token**: —Å–æ–¥–µ—Ä–∂–∏—Ç `user_id`, `email`, `expires_at` (–∏—Å—Ç–µ–∫–∞–µ—Ç –±—ã—Å—Ç—Ä–æ)
- **Refresh Token**: —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π –∫–ª—é—á –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access —Ç–æ–∫–µ–Ω–∞

---

### **2Ô∏è‚É£ –†–∞–±–æ—Ç–∞ —Å API (–æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å)**

```
–§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí GET /chat/chats
           + Authorization: Bearer <access_token>
                ‚Üì
–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç access_token
                ‚Üì
‚úÖ –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

---

### **3Ô∏è‚É£ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ Access Token –∏—Å—Ç–µ–∫?**

```
–§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí GET /chat/chats
           + Authorization: Bearer <–∏—Å—Ç–µ–∫—à–∏–π access_token>
                ‚Üì
–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω
                ‚Üì
‚ùå –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 Unauthorized
                ‚Üì
–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
  1. –ë–µ—Ä–µ—Ç refresh_token
  2. POST /auth/refresh + refresh_token
                ‚Üì
–°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç refresh_token
                ‚Üì
‚úÖ Refresh –≤–∞–ª–∏–¥–µ–Ω ‚Üí –í—ã–¥–∞–µ—Ç –ù–û–í–´–ô access_token
                ‚Üì
–§—Ä–æ–Ω—Ç–µ–Ω–¥:
  1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–π access_token
  2. –ü–û–í–¢–û–†–Ø–ï–¢ –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
                ‚Üì
‚úÖ –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—Ç–∏–ª!
```

---

### **4Ô∏è‚É£ –ï—Å–ª–∏ Refresh Token —Ç–æ–∂–µ –∏—Å—Ç–µ–∫**

```
–§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí POST /auth/refresh + –∏—Å—Ç–µ–∫—à–∏–π refresh_token
                ‚Üì
–°–µ—Ä–≤–µ—Ä ‚Üí ‚ùå Refresh —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫
                ‚Üì
–§—Ä–æ–Ω—Ç–µ–Ω–¥:
  1. –£–¥–∞–ª—è–µ—Ç –æ–±–∞ —Ç–æ–∫–µ–Ω–∞
  2. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login
  3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —Å–Ω–æ–≤–∞
```

---

## **üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**

### **–ë–µ–∑ Refresh —Ç–æ–∫–µ–Ω–∞ (—Ç–æ–ª—å–∫–æ Access):**
‚ùå Access —Ç–æ–∫–µ–Ω –∂–∏–≤–µ—Ç –¥–æ–ª–≥–æ (30 –¥–Ω–µ–π)
‚ùå –ï—Å–ª–∏ –µ–≥–æ —É–∫—Ä–∞–¥—É—Ç ‚Üí –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø 30 –¥–Ω–µ–π
‚ùå –ù–µ–ª—å–∑—è –æ—Ç–æ–∑–≤–∞—Ç—å —É–∫—Ä–∞–¥–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

### **–° –¥–≤—É–º—è —Ç–æ–∫–µ–Ω–∞–º–∏:**
‚úÖ **Access —Ç–æ–∫–µ–Ω –∂–∏–≤–µ—Ç 15 –º–∏–Ω—É—Ç**
  - –ï—Å–ª–∏ —É–∫—Ä–∞–¥—É—Ç ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–æ 15 –º–∏–Ω—É—Ç
  - –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ (–±–æ–ª—å—à–µ —Ä–∏—Å–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞)
  
‚úÖ **Refresh —Ç–æ–∫–µ–Ω –∂–∏–≤–µ—Ç 7 –¥–Ω–µ–π**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
  - –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ httpOnly cookie (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
  - –ú–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∑–∞–Ω–µ—Å—Ç–∏ –≤ blacklist)

---

## **üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–≤–æ–µ–º –∫–æ–¥–µ:**

### **–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ** (`src/services/auth.service.ts`):
```typescript
login: async (credentials) => {
    const response = await apiRequest('/auth/login', {...});
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–∞ —Ç–æ–∫–µ–Ω–∞
    saveToken(response.access_token);        // 15 –º–∏–Ω
    saveRefreshToken(response.refresh_token); // 7 –¥–Ω–µ–π
}
```

### **–ü—Ä–∏ –ª—é–±–æ–º –∑–∞–ø—Ä–æ—Å–µ** (`src/lib/api/client.ts`):
```typescript
// –î–æ–±–∞–≤–ª—è–µ–º access_token –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫
headers: {
    'Authorization': `Bearer ${access_token}`
}

// –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 401 (—Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫):
if (response.status === 401) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω
    const newToken = await refreshAccessToken();
    
    // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
    retry with newToken
}
```

---

## **üìä –ù–∞–≥–ª—è–¥–Ω–∞—è —Å—Ö–µ–º–∞:**

```
–î–µ–Ω—å 1:     Login ‚Üí Access (15 –º–∏–Ω) + Refresh (7 –¥–Ω–µ–π)
            ‚Üì
            [15 –º–∏–Ω —Ä–∞–±–æ—Ç—ã —Å Access]
            ‚Üì
–ú–∏–Ω—É—Ç–∞ 16:  Access –∏—Å—Ç–µ–∫ ‚Üí Auto Refresh ‚Üí –ù–æ–≤—ã–π Access (15 –º–∏–Ω)
            ‚Üì
            [15 –º–∏–Ω —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º Access]
            ‚Üì
–ú–∏–Ω—É—Ç–∞ 31:  Access –∏—Å—Ç–µ–∫ ‚Üí Auto Refresh ‚Üí –ù–æ–≤—ã–π Access (15 –º–∏–Ω)
            ‚Üì
            ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ 7 –¥–Ω–µ–π ...
            ‚Üì
–î–µ–Ω—å 8:     Refresh –∏—Å—Ç–µ–∫ ‚Üí Logout ‚Üí –ù—É–∂–µ–Ω –Ω–æ–≤—ã–π Login
```

---

## **üí° –ò—Ç–æ–≥:**

**Access Token** = –ö–æ—Ä–æ—Ç–∫–∞—è –∂–∏–∑–Ω—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
**Refresh Token** = –î–æ–ª–≥–∞—è –∂–∏–∑–Ω—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Access)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã —Å–Ω–∏–∂–∞—é—Ç —Ä–∏—Å–∫
- üîÑ –£–¥–æ–±—Å—Ç–≤–æ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–º –Ω–µ–¥–µ–ª—è–º–∏
- ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- üö´ –ö–æ–Ω—Ç—Ä–æ–ª—å: –º–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å refresh —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–í —Ç–≤–æ–µ–º —Å–ª—É—á–∞–µ:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç 7 –¥–Ω–µ–π –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ ‚Üí access —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç! üéâ